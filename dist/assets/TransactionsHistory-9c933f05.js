import{c as b,a as z,d as M,r,e as h,j as s,i as R,B as T,l as B}from"./index-bc28f289.js";import{C as F,a as P,b as q,d as I,c as W}from"./card-d5d390a5.js";import{T as G,a as O,b as g,c as i,d as J,e as d}from"./table-90bdd3a0.js";const K=b("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),Q=b("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),u=10,Y=()=>{const{user:o}=z(),{toast:m}=M(),[l,C]=r.useState([]),[N,p]=r.useState(!0),[n,f]=r.useState(0),[_,v]=r.useState(!0),w=r.useCallback(async()=>{if(o){p(!0);try{const{data:e,error:t}=await h.from("deposits").select("*").eq("user_id",o.id);if(t)throw t;const{data:c,error:j}=await h.from("withdrawals").select("*").eq("user_id",o.id);if(j)throw j;const{data:D,error:y}=await h.from("transactions").select("*").eq("user_id",o.id);if(y)throw y;const E=(e||[]).map(a=>({...a,type:"deposit"})),L=(c||[]).map(a=>({...a,type:"withdraw"})),k=(D||[]).filter(a=>["trade","swap"].includes(a.type)),x=[...E,...L,...k].sort((a,H)=>new Date(H.created_at)-new Date(a.created_at));C(x),v(x.length>(n+1)*u)}catch(e){console.error("Transaction fetch error:",e),m({variant:"destructive",title:"Failed to fetch transaction history",description:e.message})}finally{p(!1)}}},[o,m,n]);r.useEffect(()=>{w()},[w]);const S=r.useMemo(()=>{const e=n*u,t=e+u;return l.slice(e,t)},[l,n]),$=e=>{const t={completed:"default",pending:"secondary",approved:"success",rejected:"destructive",win:"success",loss:"destructive"},c=e==null?void 0:e.toLowerCase();return s.jsx(B,{variant:t[c]||"default",className:"capitalize",children:c})},A=e=>{switch(e.type){case"deposit":return`Deposit of ${e.amount} ${e.currency}`;case"withdraw":return`Withdrawal of ${e.amount} ${e.currency}`;case"swap":return`Swapped ${e.from_amount} ${e.from_symbol} for ${parseFloat(e.to_amount).toFixed(4)} ${e.to_symbol}`;case"trade":return`Trade: ${e.status==="win"?"Profit":"Loss"} of ${Math.abs(e.to_amount).toFixed(4)} ${e.to_symbol}`;default:return"Transaction"}};return s.jsxs(F,{className:"w-full glassmorphic mt-4",children:[s.jsxs(P,{children:[s.jsx(q,{children:"Transaction History"}),s.jsx(I,{children:"A log of your recent account activity."})]}),s.jsx(W,{children:N?s.jsx("div",{className:"flex justify-center items-center h-40",children:s.jsx(R,{className:"h-8 w-8 animate-spin"})}):l.length===0?s.jsx("p",{className:"text-center text-muted-foreground py-10",children:"No transactions yet."}):s.jsxs(s.Fragment,{children:[s.jsxs(G,{children:[s.jsx(O,{children:s.jsxs(g,{children:[s.jsx(i,{children:"Date"}),s.jsx(i,{children:"Type"}),s.jsx(i,{children:"Details"}),s.jsx(i,{className:"text-right",children:"Status"})]})}),s.jsx(J,{children:S.map(e=>s.jsxs(g,{children:[s.jsx(d,{children:new Date(e.created_at).toLocaleString()}),s.jsx(d,{className:"capitalize",children:e.type}),s.jsx(d,{children:A(e)}),s.jsx(d,{className:"text-right",children:$(e.status)})]},e.id))})]}),s.jsxs("div",{className:"flex items-center justify-end space-x-2 py-4",children:[s.jsxs(T,{variant:"outline",size:"sm",onClick:()=>f(e=>e-1),disabled:n===0,children:[s.jsx(K,{className:"h-4 w-4 mr-2"}),"Previous"]}),s.jsxs(T,{variant:"outline",size:"sm",onClick:()=>f(e=>e+1),disabled:!_,children:["Next",s.jsx(Q,{className:"h-4 w-4 ml-2"})]})]})]})})]})};export{Y as T};
