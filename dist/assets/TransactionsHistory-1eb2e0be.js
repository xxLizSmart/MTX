import{b as B,d as F,r,e as u,j as s,i as P,B as T,k as R}from"./index-d9a06326.js";import{C as k,a as z,b as M,c as q,d as W}from"./card-308cff17.js";import{T as G,a as I,b as g,c,d as O,e as d}from"./table-2c457f8d.js";import{A as J}from"./arrow-left-8866a27f.js";import{A as K}from"./arrow-right-6bb328b6.js";const m=10,Z=()=>{const{user:o}=B(),{toast:h}=F(),[l,b]=r.useState([]),[C,p]=r.useState(!0),[n,f]=r.useState(0),[N,_]=r.useState(!0),w=r.useCallback(async()=>{if(o){p(!0);try{const{data:e,error:t}=await u.from("deposits").select("*").eq("user_id",o.id);if(t)throw t;const{data:i,error:j}=await u.from("withdrawals").select("*").eq("user_id",o.id);if(j)throw j;const{data:A,error:x}=await u.from("transactions").select("*").eq("user_id",o.id);if(x)throw x;const D=(e||[]).map(a=>({...a,type:"deposit"})),E=(i||[]).map(a=>({...a,type:"withdraw"})),H=(A||[]).filter(a=>["trade","swap"].includes(a.type)),y=[...D,...E,...H].sort((a,L)=>new Date(L.created_at)-new Date(a.created_at));b(y),_(y.length>(n+1)*m)}catch(e){console.error("Transaction fetch error:",e),h({variant:"destructive",title:"Failed to fetch transaction history",description:e.message})}finally{p(!1)}}},[o,h,n]);r.useEffect(()=>{w()},[w]);const v=r.useMemo(()=>{const e=n*m,t=e+m;return l.slice(e,t)},[l,n]),S=e=>{const t={completed:"default",pending:"secondary",approved:"success",rejected:"destructive",win:"success",loss:"destructive"},i=e==null?void 0:e.toLowerCase();return s.jsx(R,{variant:t[i]||"default",className:"capitalize",children:i})},$=e=>{switch(e.type){case"deposit":return`Deposit of ${e.amount} ${e.currency}`;case"withdraw":return`Withdrawal of ${e.amount} ${e.currency}`;case"swap":return`Swapped ${e.from_amount} ${e.from_symbol} for ${parseFloat(e.to_amount).toFixed(4)} ${e.to_symbol}`;case"trade":return`Trade: ${e.status==="win"?"Profit":"Loss"} of ${Math.abs(e.to_amount).toFixed(4)} ${e.to_symbol}`;default:return"Transaction"}};return s.jsxs(k,{className:"w-full glassmorphic mt-4",children:[s.jsxs(z,{children:[s.jsx(M,{children:"Transaction History"}),s.jsx(q,{children:"A log of your recent account activity."})]}),s.jsx(W,{children:C?s.jsx("div",{className:"flex justify-center items-center h-40",children:s.jsx(P,{className:"h-8 w-8 animate-spin"})}):l.length===0?s.jsx("p",{className:"text-center text-muted-foreground py-10",children:"No transactions yet."}):s.jsxs(s.Fragment,{children:[s.jsxs(G,{children:[s.jsx(I,{children:s.jsxs(g,{children:[s.jsx(c,{children:"Date"}),s.jsx(c,{children:"Type"}),s.jsx(c,{children:"Details"}),s.jsx(c,{className:"text-right",children:"Status"})]})}),s.jsx(O,{children:v.map(e=>s.jsxs(g,{children:[s.jsx(d,{children:new Date(e.created_at).toLocaleString()}),s.jsx(d,{className:"capitalize",children:e.type}),s.jsx(d,{children:$(e)}),s.jsx(d,{className:"text-right",children:S(e.status)})]},e.id))})]}),s.jsxs("div",{className:"flex items-center justify-end space-x-2 py-4",children:[s.jsxs(T,{variant:"outline",size:"sm",onClick:()=>f(e=>e-1),disabled:n===0,children:[s.jsx(J,{className:"h-4 w-4 mr-2"}),"Previous"]}),s.jsxs(T,{variant:"outline",size:"sm",onClick:()=>f(e=>e+1),disabled:!N,children:["Next",s.jsx(K,{className:"h-4 w-4 ml-2"})]})]})]})})]})};export{Z as T};
