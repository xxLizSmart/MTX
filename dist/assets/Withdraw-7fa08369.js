import{r as a,n as B,o as M,p as Y,j as e,P as A,q as P,s as W,t as K,R as O,v as I,C as U,u as $,d as z,a as X,L as V,B as G,e as S}from"./index-54782b7e.js";import{H as J}from"./Helmet-ef389142.js";import{I as T}from"./input-79cb34a4.js";import{L as E}from"./label-c6eae2b9.js";import{C as Q,a as Z,b as ee,d as te,c as se}from"./card-3a5886c1.js";import{S as re,a as ae,b as ne,c as oe,d as N}from"./select-8467d8a7.js";import{A as ie}from"./alert-triangle-ec91ecb7.js";function ce(t){const s=a.useRef({value:t,previous:t});return a.useMemo(()=>(s.current.value!==t&&(s.current.previous=s.current.value,s.current.value=t),s.current.previous),[t])}var R="Checkbox",[de,je]=B(R),[le,ue]=de(R),_=a.forwardRef((t,s)=>{const{__scopeCheckbox:r,name:d,checked:o,defaultChecked:i,required:u,disabled:l,value:p="on",onCheckedChange:j,form:h,...g}=t,[c,w]=a.useState(null),y=M(s,n=>w(n)),m=a.useRef(!1),f=c?h||!!c.closest("form"):!0,[x=!1,b]=Y({prop:o,defaultProp:i,onChange:j}),k=a.useRef(x);return a.useEffect(()=>{const n=c==null?void 0:c.form;if(n){const v=()=>b(k.current);return n.addEventListener("reset",v),()=>n.removeEventListener("reset",v)}},[c,b]),e.jsxs(le,{scope:r,state:x,disabled:l,children:[e.jsx(A.button,{type:"button",role:"checkbox","aria-checked":C(x)?"mixed":x,"aria-required":u,"data-state":L(x),"data-disabled":l?"":void 0,disabled:l,value:p,...g,ref:y,onKeyDown:P(t.onKeyDown,n=>{n.key==="Enter"&&n.preventDefault()}),onClick:P(t.onClick,n=>{b(v=>C(v)?!0:!v),f&&(m.current=n.isPropagationStopped(),m.current||n.stopPropagation())})}),f&&e.jsx(he,{control:c,bubbles:!m.current,name:d,value:p,checked:x,required:u,disabled:l,form:h,style:{transform:"translateX(-100%)"},defaultChecked:C(i)?!1:i})]})});_.displayName=R;var D="CheckboxIndicator",q=a.forwardRef((t,s)=>{const{__scopeCheckbox:r,forceMount:d,...o}=t,i=ue(D,r);return e.jsx(W,{present:d||C(i.state)||i.state===!0,children:e.jsx(A.span,{"data-state":L(i.state),"data-disabled":i.disabled?"":void 0,...o,ref:s,style:{pointerEvents:"none",...t.style}})})});q.displayName=D;var he=t=>{const{control:s,checked:r,bubbles:d=!0,defaultChecked:o,...i}=t,u=a.useRef(null),l=ce(r),p=K(s);a.useEffect(()=>{const h=u.current,g=window.HTMLInputElement.prototype,w=Object.getOwnPropertyDescriptor(g,"checked").set;if(l!==r&&w){const y=new Event("click",{bubbles:d});h.indeterminate=C(r),w.call(h,C(r)?!1:r),h.dispatchEvent(y)}},[l,r,d]);const j=a.useRef(C(r)?!1:r);return e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:o??j.current,...i,tabIndex:-1,ref:u,style:{...t.style,...p,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function C(t){return t==="indeterminate"}function L(t){return C(t)?"indeterminate":t?"checked":"unchecked"}var F=_,me=q;const H=O.forwardRef(({className:t,...s},r)=>e.jsx(F,{ref:r,className:I("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...s,children:e.jsx(me,{className:I("flex items-center justify-center text-current"),children:e.jsx(U,{className:"h-4 w-4"})})}));H.displayName=F.displayName;const ge=()=>{const{t}=$(),{toast:s}=z(),{user:r,userProfile:d}=X(),[o,i]=a.useState("USDT"),[u,l]=a.useState(""),[p,j]=a.useState(""),[h,g]=a.useState(!1),[c,w]=a.useState(!1),y=async m=>{if(m.preventDefault(),(d==null?void 0:d.kyc_status)!=="approved"){s({variant:"destructive",title:"KYC Required",description:"Please complete and wait for KYC approval to withdraw funds."});return}if(!o||!u||!p){s({variant:"destructive",title:"Missing Information",description:"Please fill all fields."});return}if(!h){s({variant:"destructive",title:"Agreement Required",description:"You must agree to the terms and services."});return}w(!0);try{const{data:f,error:x}=await S.from("user_assets").select("*").eq("user_id",r.id).eq("symbol",o).single();if(x||!f)throw new Error("Could not fetch your balance. You may not have funds in this currency.");const b=parseFloat(f.amount),k=parseFloat(p);if(k>b)throw new Error(`Insufficient funds. Your balance is ${b} ${o}.`);const{error:n}=await S.from("user_assets").update({amount:b-k}).eq("id",f.id);if(n)throw n;const{error:v}=await S.from("withdrawals").insert({user_id:r.id,amount:k,currency:o,wallet_address:u,status:"pending"});if(v)throw await S.from("user_assets").update({amount:b}).eq("id",f.id),v;s({title:"Withdrawal Request Submitted",description:"Your funds have been deducted and are pending review."}),i("USDT"),l(""),j(""),g(!1)}catch(f){s({variant:"destructive",title:"Withdrawal Failed",description:f.message})}finally{w(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(J,{children:e.jsxs("title",{children:[t("withdraw")," - MetaTradeX"]})}),e.jsx("div",{className:"container mx-auto p-4 sm:p-6 lg:p-8 flex justify-center items-center min-h-[calc(100vh-4rem)]",children:e.jsxs(Q,{className:"w-full max-w-lg glassmorphic",children:[e.jsxs(Z,{children:[e.jsx(ee,{className:"text-3xl font-bold",children:t("withdraw")}),e.jsx(te,{children:"Enter your wallet details to withdraw funds."})]}),e.jsx(se,{children:e.jsxs("form",{onSubmit:y,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(E,{children:"Currency"}),e.jsxs(re,{onValueChange:i,value:o,children:[e.jsx(ae,{children:e.jsx(ne,{placeholder:"Select a currency"})}),e.jsxs(oe,{children:[e.jsx(N,{value:"USDT",children:"USDT"}),e.jsx(N,{value:"BTC",children:"BTC"}),e.jsx(N,{value:"ETH",children:"ETH"})]})]})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"address",children:"Wallet Address"}),e.jsx(T,{id:"address",type:"text",value:u,onChange:m=>l(m.target.value),placeholder:"Your wallet address"})]}),e.jsxs("div",{children:[e.jsxs(E,{htmlFor:"amount",children:["Amount (",o,")"]}),e.jsx(T,{id:"amount",type:"number",value:p,onChange:m=>j(m.target.value),placeholder:`Enter amount in ${o}`})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{id:"terms",checked:h,onCheckedChange:g}),e.jsxs("label",{htmlFor:"terms",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:["I agree to the ",e.jsx(V,{to:"/terms",className:"underline text-primary",children:"terms and services"}),"."]})]}),e.jsxs("div",{className:"mt-4 p-3 rounded-lg bg-yellow-400/10 text-yellow-500 border border-yellow-400/20",children:[e.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5"}),"Important Notice"]}),e.jsxs("ul",{className:"list-disc list-inside text-xs mt-2 space-y-1",children:[e.jsx("li",{children:"Withdrawals are processed within 24 hours."}),e.jsx("li",{children:"Ensure the wallet address is correct and corresponds to the selected currency."}),e.jsx("li",{children:"Transactions are irreversible. We are not responsible for funds sent to the wrong address."})]})]}),e.jsx(G,{type:"submit",className:"w-full !mt-8",size:"lg",disabled:c,children:c?"Processing...":t("submit")})]})})]})})]})};export{ge as default};
