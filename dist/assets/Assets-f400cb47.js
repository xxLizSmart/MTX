import{u as E,h as F,b as U,a as k,d as T,r as t,e as g,j as e,i as f,B as o}from"./index-54782b7e.js";import{H}from"./Helmet-ef389142.js";import{C as I,c as $}from"./card-3a5886c1.js";import{I as j}from"./input-79cb34a4.js";import{L as q}from"./label-c6eae2b9.js";import{D as B,a as R,b as z,c as A,d as M,e as O}from"./dialog-6b919f5f.js";import{P as X}from"./pen-square-a5168beb.js";const Z=()=>{const{t:d}=E(),{formatCurrency:C,currency:v,exchangeRates:w}=F(),N=U(),{userProfile:m}=k(),{toast:r}=T(),[b,L]=t.useState([]),[h,S]=t.useState(""),[x,i]=t.useState(!0),[a,l]=t.useState(null),[n,p]=t.useState(""),u=t.useCallback(async()=>{i(!0);try{const{data:s,error:c}=await g.from("assets").select("*").order("id");if(c)throw c;L(s)}catch(s){console.error("Error fetching assets:",s),r({variant:"destructive",title:"Failed to fetch assets",description:s.message})}finally{i(!1)}},[r]);t.useEffect(()=>{u()},[u]);const _=s=>{l(s),p(s.price)},y=async()=>{if(!a||!n||parseFloat(n)<0){r({variant:"destructive",title:"Invalid Price",description:"Please enter a valid price."});return}i(!0);const{error:s}=await g.from("assets").update({price:parseFloat(n)}).eq("id",a.id);s?r({variant:"destructive",title:"Update Failed",description:s.message}):(r({title:"Success!",description:`${a.name} price updated.`}),l(null),p(""),await u()),i(!1)},P=b.filter(s=>s.name.toLowerCase().includes(h.toLowerCase())||s.symbol.toLowerCase().includes(h.toLowerCase())),D=s=>{const c=w[v.toLowerCase()]||1;return s*c};return e.jsxs(e.Fragment,{children:[e.jsx(H,{children:e.jsxs("title",{children:[d("assets")," - MetaTradeX"]})}),e.jsxs("div",{className:"container mx-auto p-4 sm:p-6 lg:p-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-6 gap-4",children:[e.jsx("h1",{className:"text-3xl font-bold",children:d("topCryptos")}),e.jsx("div",{className:"w-full sm:w-auto sm:max-w-xs",children:e.jsx(j,{type:"text",placeholder:"Search assets...",value:h,onChange:s=>S(s.target.value)})})]}),x&&!a?e.jsx("div",{className:"text-center h-64 flex items-center justify-center",children:e.jsx(f,{className:"h-10 w-10 animate-spin"})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:P.map(s=>e.jsxs(I,{className:"hover:shadow-lg transition-shadow glassmorphic relative",children:[(m==null?void 0:m.is_admin)&&e.jsx(o,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 h-8 w-8",onClick:()=>_(s),children:e.jsx(X,{className:"h-4 w-4"})}),e.jsxs($,{className:"p-4 flex flex-col justify-between h-full",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("img",{src:s.icon_url,alt:s.name,className:"h-10 w-10 mr-4"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-lg",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.symbol.toUpperCase()})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-lg",children:C(D(s.price))}),e.jsxs("p",{className:`text-sm ${s.price_change_percentage_24h>=0?"text-green-500":"text-red-500"}`,children:[s.price_change_percentage_24h?s.price_change_percentage_24h.toFixed(2):"0.00","%"]})]}),e.jsx(o,{className:"w-full mt-4",onClick:()=>N(`/trading/${s.symbol.toLowerCase()}`),children:d("trading")})]})]},s.id))})]}),e.jsx(B,{open:!!a,onOpenChange:()=>l(null),children:e.jsxs(R,{children:[e.jsxs(z,{children:[e.jsxs(A,{children:["Edit Price for ",a==null?void 0:a.name]}),e.jsxs(M,{children:["Update the price for ",a==null?void 0:a.symbol.toUpperCase(),"."]})]}),e.jsxs("div",{className:"py-4",children:[e.jsx(q,{htmlFor:"price",children:"New Price (USD)"}),e.jsx(j,{id:"price",type:"number",value:n,onChange:s=>p(s.target.value),placeholder:"Enter new price"})]}),e.jsxs(O,{children:[e.jsx(o,{variant:"outline",onClick:()=>l(null),children:"Cancel"}),e.jsx(o,{onClick:y,disabled:x,children:x?e.jsx(f,{className:"h-4 w-4 animate-spin"}):"Update Price"})]})]})})]})};export{Z as default};
