import{c as g,a as I,h as F,u as Y,b as z,d as B,r as c,e as x,j as e,B as i,A as O,S as X,i as T}from"./index-82282070.js";import{H as G}from"./Helmet-45f5d049.js";import{C as A,a as E,b as S,d as L}from"./card-1c00b626.js";import{T as J,a as K,b as D,c as H}from"./tabs-06e94873.js";import{T as Q}from"./TransactionsHistory-1dff115a.js";import{C as W}from"./cryptoPrices-f92ea880.js";import"./table-914bf941.js";import"./arrow-left-36b86dd6.js";import"./arrow-right-953818e8.js";const Z=g("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]),ee=g("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),se=g("Repeat",[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]]),de=()=>{const{t:n}=I(),{formatCurrency:p,currency:M,exchangeRates:R}=F(),r=Y(),{user:t,userProfile:u}=z(),{toast:j}=B(),[y,q]=c.useState([]),[b,v]=c.useState(!0),[P,V]=c.useState(0),o=c.useCallback(async()=>{if(t){v(!0);try{const[{data:s,error:m},{data:U,error:w}]=await Promise.all([x.from("user_assets").select("symbol, amount").eq("user_id",t.id),x.from("assets").select("symbol, price, icon_url, name")]);if(m)throw m;if(w)throw w;const d=Object.entries(W).reduce((a,[h,l])=>(a[h]={price:l.price,icon:l.icon_url,name:l.name},a),{});(U||[]).forEach(a=>{d[a.symbol]={price:a.price,icon:a.icon_url,name:a.name}});let N=0;const $=(s||[]).map(a=>{var C,k,_;const h=((C=d[a.symbol])==null?void 0:C.price)||0,l=a.amount*h;return N+=l,{symbol:a.symbol,name:((k=d[a.symbol])==null?void 0:k.name)||a.symbol,amount:a.amount,value:l,price:h,logo:(_=d[a.symbol])==null?void 0:_.icon}}).filter(a=>a.amount>0);q($),V(N)}catch(s){console.error("Error fetching portfolio data:",s),j({variant:"destructive",title:"Error",description:"Could not fetch portfolio data."})}finally{v(!1)}}},[t,j]);c.useEffect(()=>{o();const s=x.channel("realtime-portfolio").on("postgres_changes",{event:"*",schema:"public",table:"user_assets",filter:`user_id=eq.${t==null?void 0:t.id}`},()=>{o()}).on("postgres_changes",{event:"*",schema:"public",table:"deposits",filter:`user_id=eq.${t==null?void 0:t.id}`},()=>{o()}).on("postgres_changes",{event:"*",schema:"public",table:"withdrawals",filter:`user_id=eq.${t==null?void 0:t.id}`},()=>{o()}).on("postgres_changes",{event:"*",schema:"public",table:"transactions",filter:`user_id=eq.${t==null?void 0:t.id}`},()=>{o()}).subscribe();return()=>{x.removeChannel(s)}},[o,t==null?void 0:t.id]);const f=s=>{const m=R[M.toLowerCase()]||1;return s*m};return e.jsxs(e.Fragment,{children:[e.jsx(G,{children:e.jsxs("title",{children:[n("portfolio")," - MetaTradeX"]})}),e.jsxs("div",{className:"container mx-auto px-6 py-4 sm:p-6 lg:p-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold tracking-tight",children:n("portfolio")}),e.jsx("p",{className:"text-muted-foreground mt-2 text-sm sm:text-base",children:"An overview of your crypto assets and history."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(i,{className:"min-h-[44px]",onClick:()=>r("/deposit"),children:[e.jsx(O,{className:"mr-2 h-4 w-4"}),n("deposit")]}),e.jsxs(i,{className:"min-h-[44px]",onClick:()=>r("/withdraw"),children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),n("withdraw")]}),e.jsxs(i,{variant:"outline",className:"min-h-[44px]",onClick:()=>r("/swap"),children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),n("swap")]}),(u==null?void 0:u.is_admin)&&e.jsxs(i,{variant:"secondary",onClick:()=>r("/admin"),children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),"Admin"]})]})]}),e.jsxs(A,{className:"bg-gradient-to-br from-primary/10 via-background to-secondary/10 glowing-border mb-8",children:[e.jsx(E,{children:e.jsx(S,{className:"text-muted-foreground font-normal",children:"Total Portfolio Value"})}),e.jsx(L,{children:e.jsx("p",{className:"text-3xl sm:text-4xl lg:text-5xl font-bold tracking-tight",children:b?e.jsx(T,{className:"h-12 w-12 animate-spin"}):p(f(P))})})]}),e.jsxs(J,{defaultValue:"assets",className:"w-full",children:[e.jsxs(K,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsx(D,{value:"assets",children:"Your Assets"}),e.jsxs(D,{value:"history",children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),"History"]})]}),e.jsx(H,{value:"assets",children:b?e.jsx("div",{className:"text-center p-10",children:e.jsx(T,{className:"mx-auto h-10 w-10 animate-spin"})}):y.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:y.map(s=>e.jsxs(A,{className:"flex flex-col glassmorphic hover:border-primary transition-all",children:[e.jsxs(E,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.logo&&e.jsx("img",{src:s.logo,alt:s.symbol,className:"h-10 w-10"}),e.jsxs("div",{children:[e.jsx(S,{className:"text-lg",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.symbol})]})]}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>r(`/trading/${s.symbol.toLowerCase()}`),children:"Trade"})]}),e.jsxs(L,{className:"flex-grow flex flex-col justify-end",children:[e.jsx("p",{className:"text-2xl font-bold",children:p(f(s.value))}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[parseFloat(s.amount).toFixed(6)," ",s.symbol," @ ",p(f(s.price))]})]})]},s.symbol))}):e.jsxs("div",{className:"text-center py-20 px-4 rounded-lg border-2 border-dashed",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Your portfolio is empty."}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Deposit funds to start your trading journey."}),e.jsx(i,{className:"mt-4",onClick:()=>r("/deposit"),children:"Deposit Now"})]})}),e.jsx(H,{value:"history",children:e.jsx(Q,{})})]})]})]})};export{de as default};
