import{c as L,u as q,a as H,d as A,r as a,j as e,m as F,V as I,B as $,X as B,i as y,e as v}from"./index-bc28f289.js";import{H as P}from"./Helmet-2bae2f2d.js";import{C as o,a as d,b as m,d as C,c as x}from"./card-d5d390a5.js";import{I as X}from"./input-e21fa800.js";import{T as Y,a as G,b as f,c as T,d as M,e as h}from"./table-90bdd3a0.js";import{C as U}from"./copy-c732d4c5.js";import{A as z}from"./award-7aceca97.js";const J=L("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),re=()=>{q();const{user:t,userProfile:u}=H(),{toast:i}=A(),[j,k]=a.useState(""),[g,R]=a.useState([]),[S,_]=a.useState(0),[p,w]=a.useState(!0);a.useEffect(()=>{u&&k(u.referral_code)},[u]),a.useEffect(()=>{t&&(async()=>{if(t){w(!0);const{data:l,error:s}=await v.from("referrals").select("created_at, referred_id, reward_amount, status").eq("referrer_id",t.id),n=await Promise.all((l||[]).map(async c=>{const{data:N}=await v.from("profiles").select("id, first_name, last_name").eq("id",c.referred_id).maybeSingle();return{...c,referee:N}}));if(s)console.error("Error fetching referrals:",s),i({variant:"destructive",title:"Error Fetching Referrals",description:s.message});else{R(n);const c=(l||[]).reduce((N,D)=>N+(parseFloat(D.reward_amount)||0),0);_(c)}w(!1)}})()},[t,i]);const b=`${window.location.origin}/register?ref=${j}`,E=r=>{if(!r){i({variant:"destructive",title:"Error",description:"Content not available."});return}navigator.clipboard.writeText(r),i({title:"Copied!",description:"Referral link copied to clipboard."})};return e.jsxs(e.Fragment,{children:[e.jsx(P,{children:e.jsx("title",{children:"Referral Program - MetaTradeX"})}),e.jsxs("div",{className:"container mx-auto p-4 sm:p-6 lg:p-8",children:[e.jsxs(F.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"text-center mb-12",children:[e.jsx(J,{className:"mx-auto h-16 w-16 text-primary mb-4"}),e.jsx("h1",{className:"text-5xl font-extrabold tracking-tight gradient-text",children:"Invite & Earn"}),e.jsx("p",{className:"mt-4 text-lg text-muted-foreground max-w-2xl mx-auto",children:"Share your love for MetaTradeX and earn rewards. Your friends get a sign-up bonus, and you get commission on their trades."})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-8 mb-12 items-center",children:[e.jsxs(o,{className:"glassmorphic glowing-border",children:[e.jsxs(d,{children:[e.jsxs(m,{className:"text-2xl flex items-center gap-2",children:[e.jsx(I,{className:"h-6 w-6 text-primary"})," Your Referral Link"]}),e.jsx(C,{children:"Share this unique link with your friends."})]}),e.jsxs(x,{className:"flex items-center gap-4",children:[e.jsx(X,{value:j?b:"Generating...",readOnly:!0,className:"text-md font-mono bg-background/50 flex-grow"}),e.jsx($,{onClick:()=>E(b),size:"icon",variant:"outline",disabled:!j,children:e.jsx(U,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(o,{className:"glassmorphic",children:[e.jsxs(d,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Total Referrals"}),e.jsx(B,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:p?e.jsx(y,{className:"animate-spin h-6 w-6"}):g.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"friends have joined."})]})]}),e.jsxs(o,{className:"glassmorphic",children:[e.jsxs(d,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Total Rewards"}),e.jsx(z,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:p?e.jsx(y,{className:"animate-spin h-6 w-6"}):`$${S.toFixed(2)}`}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"earned from referrals."})]})]})]})]}),e.jsxs(o,{className:"glassmorphic",children:[e.jsxs(d,{children:[e.jsx(m,{children:"Your Referred Users"}),e.jsx(C,{children:"Track the friends who have successfully signed up using your link."})]}),e.jsx(x,{children:e.jsxs(Y,{children:[e.jsx(G,{children:e.jsxs(f,{children:[e.jsx(T,{children:"Name"}),e.jsx(T,{className:"text-right",children:"Date Joined"})]})}),e.jsx(M,{children:p?e.jsx(f,{children:e.jsx(h,{colSpan:"2",className:"text-center h-24",children:e.jsx(y,{className:"mx-auto h-6 w-6 animate-spin"})})}):g.length>0?g.map((r,l)=>{var s,n;return e.jsxs(f,{children:[e.jsxs(h,{className:"font-medium",children:[((s=r.referee)==null?void 0:s.first_name)||"Anonymous"," ",((n=r.referee)==null?void 0:n.last_name)||""]}),e.jsx(h,{className:"text-right text-muted-foreground",children:new Date(r.created_at).toLocaleDateString()})]},l)}):e.jsx(f,{children:e.jsx(h,{colSpan:"2",className:"text-center h-24 text-muted-foreground",children:"No one has used your referral link yet."})})})]})})]})]})]})};export{re as default};
