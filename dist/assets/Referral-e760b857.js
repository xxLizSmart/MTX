import{c as L,a as q,b as H,d as A,r as a,j as e,m as F,O as I,B as $,i as N,e as v}from"./index-d9a06326.js";import{H as B}from"./Helmet-90a894cc.js";import{C as c,a as d,b as m,c as C,d as x}from"./card-308cff17.js";import{I as P}from"./input-d1fd22f3.js";import{T as U,a as Y,b as f,c as T,d as G,e as h}from"./table-2c457f8d.js";import{C as M}from"./copy-b3ff15e4.js";import{U as O}from"./users-7392cd9f.js";import{A as X}from"./award-93025724.js";const z=L("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),re=()=>{q();const{user:t,userProfile:u}=H(),{toast:i}=A(),[j,k]=a.useState(""),[p,R]=a.useState([]),[S,_]=a.useState(0),[g,w]=a.useState(!0);a.useEffect(()=>{u&&k(u.referral_code)},[u]),a.useEffect(()=>{t&&(async()=>{if(t){w(!0);const{data:l,error:r}=await v.from("referrals").select("created_at, referred_id, reward_amount, status").eq("referrer_id",t.id),n=await Promise.all((l||[]).map(async o=>{const{data:y}=await v.from("profiles").select("id, first_name, last_name").eq("id",o.referred_id).maybeSingle();return{...o,referee:y}}));if(r)console.error("Error fetching referrals:",r),i({variant:"destructive",title:"Error Fetching Referrals",description:r.message});else{R(n);const o=(l||[]).reduce((y,D)=>y+(parseFloat(D.reward_amount)||0),0);_(o)}w(!1)}})()},[t,i]);const b=`${window.location.origin}/register?ref=${j}`,E=s=>{if(!s){i({variant:"destructive",title:"Error",description:"Content not available."});return}navigator.clipboard.writeText(s),i({title:"Copied!",description:"Referral link copied to clipboard."})};return e.jsxs(e.Fragment,{children:[e.jsx(B,{children:e.jsx("title",{children:"Referral Program - MetaTradeX"})}),e.jsxs("div",{className:"container mx-auto px-6 py-4 sm:p-6 lg:p-8",children:[e.jsxs(F.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"text-center mb-12",children:[e.jsx(z,{className:"mx-auto h-12 w-12 sm:h-16 sm:w-16 text-primary mb-4"}),e.jsx("h1",{className:"text-3xl sm:text-4xl lg:text-5xl font-extrabold tracking-tight gradient-text",children:"Invite & Earn"}),e.jsx("p",{className:"mt-4 text-sm sm:text-lg text-muted-foreground max-w-2xl mx-auto",children:"Share your love for MetaTradeX and earn rewards. Your friends get a sign-up bonus, and you get commission on their trades."})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-8 mb-12 items-center",children:[e.jsxs(c,{className:"glassmorphic glowing-border",children:[e.jsxs(d,{children:[e.jsxs(m,{className:"text-2xl flex items-center gap-2",children:[e.jsx(I,{className:"h-6 w-6 text-primary"})," Your Referral Link"]}),e.jsx(C,{children:"Share this unique link with your friends."})]}),e.jsxs(x,{className:"flex items-center gap-4",children:[e.jsx(P,{value:j?b:"Generating...",readOnly:!0,className:"text-md font-mono bg-background/50 flex-grow"}),e.jsx($,{onClick:()=>E(b),size:"icon",variant:"outline",disabled:!j,children:e.jsx(M,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(c,{className:"glassmorphic",children:[e.jsxs(d,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Total Referrals"}),e.jsx(O,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:g?e.jsx(N,{className:"animate-spin h-6 w-6"}):p.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"friends have joined."})]})]}),e.jsxs(c,{className:"glassmorphic",children:[e.jsxs(d,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Total Rewards"}),e.jsx(X,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:g?e.jsx(N,{className:"animate-spin h-6 w-6"}):`$${S.toFixed(2)}`}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"earned from referrals."})]})]})]})]}),e.jsxs(c,{className:"glassmorphic",children:[e.jsxs(d,{children:[e.jsx(m,{children:"Your Referred Users"}),e.jsx(C,{children:"Track the friends who have successfully signed up using your link."})]}),e.jsx(x,{children:e.jsxs(U,{children:[e.jsx(Y,{children:e.jsxs(f,{children:[e.jsx(T,{children:"Name"}),e.jsx(T,{className:"text-right",children:"Date Joined"})]})}),e.jsx(G,{children:g?e.jsx(f,{children:e.jsx(h,{colSpan:"2",className:"text-center h-24",children:e.jsx(N,{className:"mx-auto h-6 w-6 animate-spin"})})}):p.length>0?p.map((s,l)=>{var r,n;return e.jsxs(f,{children:[e.jsxs(h,{className:"font-medium",children:[((r=s.referee)==null?void 0:r.first_name)||"Anonymous"," ",((n=s.referee)==null?void 0:n.last_name)||""]}),e.jsx(h,{className:"text-right text-muted-foreground",children:new Date(s.created_at).toLocaleDateString()})]},l)}):e.jsx(f,{children:e.jsx(h,{colSpan:"2",className:"text-center h-24 text-muted-foreground",children:"No one has used your referral link yet."})})})]})})]})]})]})};export{re as default};
