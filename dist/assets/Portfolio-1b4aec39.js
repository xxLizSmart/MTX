import{c as H,u as F,h as I,b as B,a as Y,d as z,r as d,e as m,j as e,B as i,A as X,k as G,S as J,i as T}from"./index-a74a7c1a.js";import{H as K}from"./Helmet-9de942c9.js";import{C as _,a as A,b as L,c as S}from"./card-1049f9d3.js";import{T as O,a as Q,b as D,c as E}from"./tabs-d0953c17.js";import{T as W}from"./TransactionsHistory-94340a30.js";import"./table-f2f825df.js";const Z=H("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),ee=H("Repeat",[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]]),ie=()=>{const{t:n}=F(),{formatCurrency:h,currency:q,exchangeRates:M}=I(),l=B(),{user:t,userProfile:x}=Y(),{toast:f}=z(),[g,V]=d.useState([]),[j,y]=d.useState(!0),[R,P]=d.useState(0),c=d.useCallback(async()=>{if(t){y(!0);try{const[{data:s,error:r},{data:U,error:b}]=await Promise.all([m.from("user_assets").select("symbol, amount").eq("user_id",t.id),m.from("assets").select("symbol, price, icon_url, name")]);if(r)throw r;if(b)throw b;const p=(U||[]).reduce((a,o)=>(a[o.symbol]={price:o.price,icon:o.icon_url,name:o.name},a),{});let v=0;const $=(s||[]).map(a=>{var N,C,k;const o=((N=p[a.symbol])==null?void 0:N.price)||0,w=a.amount*o;return v+=w,{symbol:a.symbol,name:((C=p[a.symbol])==null?void 0:C.name)||a.symbol,amount:a.amount,value:w,price:o,logo:(k=p[a.symbol])==null?void 0:k.icon}}).filter(a=>a.amount>0);V($),P(v)}catch(s){console.error("Error fetching portfolio data:",s),f({variant:"destructive",title:"Error",description:"Could not fetch portfolio data."})}finally{y(!1)}}},[t,f]);d.useEffect(()=>{c();const s=m.channel("realtime-portfolio").on("postgres_changes",{event:"*",schema:"public",table:"deposits",filter:`user_id=eq.${t==null?void 0:t.id}`},r=>{c()}).on("postgres_changes",{event:"*",schema:"public",table:"withdrawals",filter:`user_id=eq.${t==null?void 0:t.id}`},r=>{c()}).on("postgres_changes",{event:"*",schema:"public",table:"transactions",filter:`user_id=eq.${t==null?void 0:t.id}`},r=>{c()}).subscribe();return()=>{m.removeChannel(s)}},[c,t==null?void 0:t.id]);const u=s=>{const r=M[q.toLowerCase()]||1;return s*r};return e.jsxs(e.Fragment,{children:[e.jsx(K,{children:e.jsxs("title",{children:[n("portfolio")," - MetaTradeX"]})}),e.jsxs("div",{className:"container mx-auto p-4 sm:p-6 lg:p-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold tracking-tight",children:n("portfolio")}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"An overview of your crypto assets and history."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{onClick:()=>l("/deposit"),children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),n("deposit")]}),e.jsxs(i,{onClick:()=>l("/withdraw"),children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),n("withdraw")]}),e.jsxs(i,{variant:"outline",onClick:()=>l("/swap"),children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),n("swap")]}),(x==null?void 0:x.is_admin)&&e.jsxs(i,{variant:"secondary",onClick:()=>l("/admin"),children:[e.jsx(J,{className:"mr-2 h-4 w-4"}),"Admin"]})]})]}),e.jsxs(_,{className:"bg-gradient-to-br from-primary/10 via-background to-secondary/10 glowing-border mb-8",children:[e.jsx(A,{children:e.jsx(L,{className:"text-muted-foreground font-normal",children:"Total Portfolio Value"})}),e.jsx(S,{children:e.jsx("p",{className:"text-5xl font-bold tracking-tight",children:j?e.jsx(T,{className:"h-12 w-12 animate-spin"}):h(u(R))})})]}),e.jsxs(O,{defaultValue:"assets",className:"w-full",children:[e.jsxs(Q,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsx(D,{value:"assets",children:"Your Assets"}),e.jsxs(D,{value:"history",children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),"History"]})]}),e.jsx(E,{value:"assets",children:j?e.jsx("div",{className:"text-center p-10",children:e.jsx(T,{className:"mx-auto h-10 w-10 animate-spin"})}):g.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:g.map(s=>e.jsxs(_,{className:"flex flex-col glassmorphic hover:border-primary transition-all",children:[e.jsxs(A,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.logo&&e.jsx("img",{src:s.logo,alt:s.symbol,className:"h-10 w-10"}),e.jsxs("div",{children:[e.jsx(L,{className:"text-lg",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.symbol})]})]}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>l(`/trading/${s.symbol.toLowerCase()}`),children:"Trade"})]}),e.jsxs(S,{className:"flex-grow flex flex-col justify-end",children:[e.jsx("p",{className:"text-2xl font-bold",children:h(u(s.value))}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[parseFloat(s.amount).toFixed(6)," ",s.symbol," @ ",h(u(s.price))]})]})]},s.symbol))}):e.jsxs("div",{className:"text-center py-20 px-4 rounded-lg border-2 border-dashed",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Your portfolio is empty."}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Deposit funds to start your trading journey."}),e.jsx(i,{className:"mt-4",onClick:()=>l("/deposit"),children:"Deposit Now"})]})}),e.jsx(E,{value:"history",children:e.jsx(W,{})})]})]})]})};export{ie as default};
