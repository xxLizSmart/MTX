import{c as W,j as e,k as E,B as N,C as le,X as oe,r as m,w as $e,R as Me,t as xe,d as qe,b as Ue,e as k,m as pe}from"./index-d9a06326.js";import{H as Ve}from"./Helmet-90a894cc.js";import{T as We,a as He,b as M,c as q}from"./tabs-2a543e1d.js";import{T as Y,a as K,b as z,c as j,d as X,e as w}from"./table-2c457f8d.js";import{P as Z}from"./pen-square-6c524a28.js";import{E as G}from"./eye-2a86ceb8.js";import{D as U,a as ae,b as ne,c as ie,e as ce,d as Je,f as fe}from"./dialog-8e203f57.js";import{I as V}from"./input-d1fd22f3.js";import{L}from"./label-b53f8564.js";import{R as Ye}from"./refresh-cw-0627b30a.js";const je=W("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),Ke=W("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]),Xe=W("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]),Ze=W("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Ge=W("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),$=({label:s,children:r})=>e.jsxs("div",{className:"flex items-center justify-between gap-2 py-1.5",children:[e.jsx("span",{className:"text-xs text-muted-foreground shrink-0",children:s}),e.jsx("div",{className:"text-sm text-right truncate",children:r})]}),Q=({children:s,className:r=""})=>e.jsx("div",{className:`rounded-lg border border-slate-700/60 bg-slate-900/40 p-4 space-y-1.5 ${r}`,children:s}),ge=({onApprove:s,onReject:r,loading:n})=>e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(N,{size:"sm",className:"flex-1 bg-green-600 hover:bg-green-700 text-white h-10",onClick:s,disabled:n,children:[e.jsx(le,{className:"h-4 w-4 mr-1.5"})," Approve"]}),e.jsxs(N,{size:"sm",variant:"destructive",className:"flex-1 h-10",onClick:r,disabled:n,children:[e.jsx(oe,{className:"h-4 w-4 mr-1.5"})," Reject"]})]}),Qe=({users:s,getStatusBadge:r,onEdit:n})=>e.jsx("div",{className:"space-y-3",children:s.map(c=>e.jsxs(Q,{children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("p",{className:"font-semibold text-sm truncate",children:[c.first_name||"N/A"," ",c.last_name||""]}),e.jsx("p",{className:"text-xs text-muted-foreground truncate mt-0.5",children:c.email})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[c.is_admin?e.jsx(E,{className:"bg-purple-600 text-xs",children:"Admin"}):e.jsx(E,{variant:"outline",className:"text-xs",children:"User"}),e.jsx(N,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>n(c),children:e.jsx(Z,{className:"h-3.5 w-3.5"})})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-1.5 pt-1.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground uppercase tracking-wide",children:"KYC"}),r(c.kyc_status)]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground uppercase tracking-wide",children:"Override"}),c.trade_override_status?r(c.trade_override_status):e.jsx(E,{variant:"outline",className:"text-xs",children:"Off"})]})]}),e.jsxs("p",{className:"text-[10px] text-muted-foreground pt-0.5",children:["Joined ",new Date(c.created_at).toLocaleDateString()]})]},c.id))}),es=({items:s,type:r,getStatusBadge:n,onUpdateStatus:c,onViewProof:i,loading:l})=>e.jsx("div",{className:"space-y-3",children:s.map(a=>{var o,x,p;return e.jsxs(Q,{children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("p",{className:"font-semibold text-sm truncate",children:[((o=a.users)==null?void 0:o.first_name)||"N/A"," ",((x=a.users)==null?void 0:x.last_name)||""]}),e.jsx("p",{className:"text-xs text-muted-foreground truncate mt-0.5",children:(p=a.users)==null?void 0:p.email})]}),n(a.status)]}),e.jsx($,{label:"Amount",children:e.jsxs("span",{className:"font-semibold",children:[a.amount," ",a.currency]})}),r==="withdrawals"&&a.wallet_address&&e.jsx($,{label:"Address",children:e.jsx("span",{className:"text-xs font-mono truncate max-w-[160px] inline-block",children:a.wallet_address})}),r==="deposits"&&a.proof_url&&e.jsxs(N,{variant:"outline",size:"sm",className:"w-full h-9 mt-1",onClick:()=>i(a.proof_url),children:[e.jsx(G,{className:"h-3.5 w-3.5 mr-1.5"})," View Proof"]}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:new Date(a.created_at).toLocaleString()}),a.status==="pending"&&e.jsx(ge,{loading:l,onApprove:()=>c(r,a.id,"approved",{userId:a.user_id,amount:a.amount,currency:a.currency}),onReject:()=>c(r,a.id,"rejected",{userId:a.user_id,amount:a.amount,currency:a.currency})})]},a.id)})}),ss=({users:s,getStatusBadge:r,onUpdateStatus:n,onViewDoc:c,loading:i})=>e.jsx("div",{className:"space-y-3",children:s.map(l=>e.jsxs(Q,{children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("p",{className:"font-semibold text-sm truncate",children:[l.first_name," ",l.last_name]}),e.jsx("p",{className:"text-xs text-muted-foreground truncate mt-0.5",children:l.email||"N/A"})]}),r(l.kyc_status)]}),e.jsx($,{label:"Country",children:l.country||"N/A"}),l.id_document_url&&e.jsxs(N,{variant:"outline",size:"sm",className:"w-full h-9 mt-1",onClick:()=>c(l.id_document_url),children:[e.jsx(G,{className:"h-3.5 w-3.5 mr-1.5"})," View Document"]}),l.kyc_status==="pending"&&e.jsx(ge,{loading:i,onApprove:()=>n("profiles",l.id,"approved",{kyc:!0}),onReject:()=>n("profiles",l.id,"rejected",{kyc:!0})})]},l.id))}),ts=({settings:s,onEdit:r})=>e.jsx("div",{className:"space-y-3",children:s.map(n=>e.jsxs(Q,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"font-semibold text-sm",children:[n.duration,"s Duration"]}),e.jsx(N,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>r(n),children:e.jsx(Z,{className:"h-3.5 w-3.5"})})]}),e.jsxs($,{label:"Win Rate",children:[(n.win_rate*100).toFixed(2),"%"]}),e.jsxs($,{label:"Loss Rate",children:[(n.loss_rate*100).toFixed(2),"%"]}),e.jsx($,{label:"Min Capital",children:n.min_capital})]},n.id))});function rs(s,r,{checkForDefaultPrevented:n=!0}={}){return function(i){if(s==null||s(i),n===!1||!i.defaultPrevented)return r==null?void 0:r(i)}}function we(s,r){if(typeof s=="function")return s(r);s!=null&&(s.current=r)}function ve(...s){return r=>{let n=!1;const c=s.map(i=>{const l=we(i,r);return!n&&typeof l=="function"&&(n=!0),l});if(n)return()=>{for(let i=0;i<c.length;i++){const l=c[i];typeof l=="function"?l():we(s[i],null)}}}}function ye(...s){return m.useCallback(ve(...s),s)}function as(s,r=[]){let n=[];function c(l,a){const o=m.createContext(a),x=n.length;n=[...n,a];const p=g=>{var A;const{scope:_,children:S,...y}=g,C=((A=_==null?void 0:_[s])==null?void 0:A[x])||o,F=m.useMemo(()=>y,Object.values(y));return e.jsx(C.Provider,{value:F,children:S})};p.displayName=l+"Provider";function d(g,_){var C;const S=((C=_==null?void 0:_[s])==null?void 0:C[x])||o,y=m.useContext(S);if(y)return y;if(a!==void 0)return a;throw new Error(`\`${g}\` must be used within \`${l}\``)}return[p,d]}const i=()=>{const l=n.map(a=>m.createContext(a));return function(o){const x=(o==null?void 0:o[s])||l;return m.useMemo(()=>({[`__scope${s}`]:{...o,[s]:x}}),[o,x])}};return i.scopeName=s,[c,ns(i,...r)]}function ns(...s){const r=s[0];if(s.length===1)return r;const n=()=>{const c=s.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(l){const a=c.reduce((o,{useScope:x,scopeName:p})=>{const g=x(l)[`__scope${p}`];return{...o,...g}},{});return m.useMemo(()=>({[`__scope${r.scopeName}`]:a}),[a])}};return n.scopeName=r.scopeName,n}var Ne=globalThis!=null&&globalThis.document?m.useLayoutEffect:()=>{},is=$e[" useInsertionEffect ".trim().toString()]||Ne;function cs({prop:s,defaultProp:r,onChange:n=()=>{},caller:c}){const[i,l,a]=ls({defaultProp:r,onChange:n}),o=s!==void 0,x=o?s:i;{const d=m.useRef(s!==void 0);m.useEffect(()=>{const g=d.current;g!==o&&console.warn(`${c} is changing from ${g?"controlled":"uncontrolled"} to ${o?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),d.current=o},[o,c])}const p=m.useCallback(d=>{var g;if(o){const _=os(d)?d(s):d;_!==s&&((g=a.current)==null||g.call(a,_))}else l(d)},[o,s,l,a]);return[x,p]}function ls({defaultProp:s,onChange:r}){const[n,c]=m.useState(s),i=m.useRef(n),l=m.useRef(r);return is(()=>{l.current=r},[r]),m.useEffect(()=>{var a;i.current!==n&&((a=l.current)==null||a.call(l,n),i.current=n)},[n,i]),[n,c,l]}function os(s){return typeof s=="function"}function ds(s){const r=m.useRef({value:s,previous:s});return m.useMemo(()=>(r.current.value!==s&&(r.current.previous=r.current.value,r.current.value=s),r.current.previous),[s])}function us(s){const[r,n]=m.useState(void 0);return Ne(()=>{if(s){n({width:s.offsetWidth,height:s.offsetHeight});const c=new ResizeObserver(i=>{if(!Array.isArray(i)||!i.length)return;const l=i[0];let a,o;if("borderBoxSize"in l){const x=l.borderBoxSize,p=Array.isArray(x)?x[0]:x;a=p.inlineSize,o=p.blockSize}else a=s.offsetWidth,o=s.offsetHeight;n({width:a,height:o})});return c.observe(s,{box:"border-box"}),()=>c.unobserve(s)}else n(void 0)},[s]),r}function ms(s){const r=hs(s),n=m.forwardRef((c,i)=>{const{children:l,...a}=c,o=m.Children.toArray(l),x=o.find(ps);if(x){const p=x.props.children,d=o.map(g=>g===x?m.Children.count(p)>1?m.Children.only(null):m.isValidElement(p)?p.props.children:null:g);return e.jsx(r,{...a,ref:i,children:m.isValidElement(p)?m.cloneElement(p,void 0,d):null})}return e.jsx(r,{...a,ref:i,children:l})});return n.displayName=`${s}.Slot`,n}function hs(s){const r=m.forwardRef((n,c)=>{const{children:i,...l}=n;if(m.isValidElement(i)){const a=js(i),o=fs(l,i.props);return i.type!==m.Fragment&&(o.ref=c?ve(c,a):a),m.cloneElement(i,o)}return m.Children.count(i)>1?m.Children.only(null):null});return r.displayName=`${s}.SlotClone`,r}var xs=Symbol("radix.slottable");function ps(s){return m.isValidElement(s)&&typeof s.type=="function"&&"__radixId"in s.type&&s.type.__radixId===xs}function fs(s,r){const n={...r};for(const c in r){const i=s[c],l=r[c];/^on[A-Z]/.test(c)?i&&l?n[c]=(...o)=>{const x=l(...o);return i(...o),x}:i&&(n[c]=i):c==="style"?n[c]={...i,...l}:c==="className"&&(n[c]=[i,l].filter(Boolean).join(" "))}return{...s,...n}}function js(s){var c,i;let r=(c=Object.getOwnPropertyDescriptor(s.props,"ref"))==null?void 0:c.get,n=r&&"isReactWarning"in r&&r.isReactWarning;return n?s.ref:(r=(i=Object.getOwnPropertyDescriptor(s,"ref"))==null?void 0:i.get,n=r&&"isReactWarning"in r&&r.isReactWarning,n?s.props.ref:s.props.ref||s.ref)}var ws=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],be=ws.reduce((s,r)=>{const n=ms(`Primitive.${r}`),c=m.forwardRef((i,l)=>{const{asChild:a,...o}=i,x=a?n:r;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(x,{...o,ref:l})});return c.displayName=`Primitive.${r}`,{...s,[r]:c}},{}),ee="Switch",[gs,zs]=as(ee),[vs,ys]=gs(ee),_e=m.forwardRef((s,r)=>{const{__scopeSwitch:n,name:c,checked:i,defaultChecked:l,required:a,disabled:o,value:x="on",onCheckedChange:p,form:d,...g}=s,[_,S]=m.useState(null),y=ye(r,D=>S(D)),C=m.useRef(!1),F=_?d||!!_.closest("form"):!0,[A,T]=cs({prop:i,defaultProp:l??!1,onChange:p,caller:ee});return e.jsxs(vs,{scope:n,checked:A,disabled:o,children:[e.jsx(be.button,{type:"button",role:"switch","aria-checked":A,"aria-required":a,"data-state":Ee(A),"data-disabled":o?"":void 0,disabled:o,value:x,...g,ref:y,onClick:rs(s.onClick,D=>{T(se=>!se),F&&(C.current=D.isPropagationStopped(),C.current||D.stopPropagation())})}),F&&e.jsx(Se,{control:_,bubbles:!C.current,name:c,value:x,checked:A,required:a,disabled:o,form:d,style:{transform:"translateX(-100%)"}})]})});_e.displayName=ee;var ke="SwitchThumb",Ce=m.forwardRef((s,r)=>{const{__scopeSwitch:n,...c}=s,i=ys(ke,n);return e.jsx(be.span,{"data-state":Ee(i.checked),"data-disabled":i.disabled?"":void 0,...c,ref:r})});Ce.displayName=ke;var Ns="SwitchBubbleInput",Se=m.forwardRef(({__scopeSwitch:s,control:r,checked:n,bubbles:c=!0,...i},l)=>{const a=m.useRef(null),o=ye(a,l),x=ds(n),p=us(r);return m.useEffect(()=>{const d=a.current;if(!d)return;const g=window.HTMLInputElement.prototype,S=Object.getOwnPropertyDescriptor(g,"checked").set;if(x!==n&&S){const y=new Event("click",{bubbles:c});S.call(d,n),d.dispatchEvent(y)}},[x,n,c]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n,...i,tabIndex:-1,ref:o,style:{...i.style,...p,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Se.displayName=Ns;function Ee(s){return s?"checked":"unchecked"}var Ae=_e,bs=Ce;const Re=Me.forwardRef(({className:s,...r},n)=>e.jsx(Ae,{className:xe("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...r,ref:n,children:e.jsx(bs,{className:xe("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));Re.displayName=Ae.displayName;const Ps=()=>{const{toast:s}=qe(),{session:r}=Ue(),[n,c]=m.useState("users"),[i,l]=m.useState({users:[],deposits:[],withdrawals:[],kyc:[],tradeSettings:[]}),[a,o]=m.useState(!1),[x,p]=m.useState(null),[d,g]=m.useState(null),[_,S]=m.useState([]),[y,C]=m.useState(null),[F,A]=m.useState(""),T=m.useCallback(async()=>{if(r){o(!0);try{const{data:t,error:h}=await k.from("profiles").select("*");if(h)throw new Error(`Users Fetch: ${h.message}`);const u=t||[],v=new Map(u.map(J=>[J.id,J])),{data:b,error:f}=await k.from("deposits").select("*");if(f)throw new Error(`Deposits Fetch: ${f.message}`);const{data:R,error:B}=await k.from("withdrawals").select("*");if(B)throw new Error(`Withdrawals Fetch: ${B.message}`);const{data:P,error:ue}=await k.from("profiles").select("*").in("kyc_status",["pending","approved","rejected"]);if(ue)throw new Error(`KYC Fetch: ${ue.message}`);const{data:Le,error:re}=await k.from("trade_settings").select("*").order("duration");if(re&&re.code!=="42P01")throw new Error(`Settings Fetch: ${re.message}`);const me=J=>J.map(he=>({...he,users:v.get(he.user_id)}));l({users:u,deposits:me(b||[]),withdrawals:me(R||[]),kyc:P||[],tradeSettings:Le||[]})}catch(t){console.error(t),s({variant:"destructive",title:"Failed to fetch data",description:t.message})}o(!1)}},[s,r]);m.useEffect(()=>{r&&T()},[T,r]);const D=async(t,h,u)=>{const v="https://tufxtnrmlwzgnufktelo.supabase.co",{data:{session:b}}=await k.auth.getSession(),f=await fetch(`${v}/functions/v1/admin-approve`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b.access_token}`,apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR1Znh0bnJtbHd6Z251Zmt0ZWxvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4NzMzMjYsImV4cCI6MjA4NjQ0OTMyNn0.3qkEIWXFoW0HKF2wX9Y5aPWJdVGuH6MnVrYrq_wm_ws"},body:JSON.stringify({action:u,table:t,id:h})}),R=await f.json();if(!f.ok||!R.success)throw new Error(R.error||"Edge function failed");return R},se=async(t,h,u)=>{const v=`${u}_${t==="deposits"?"deposit":"withdrawal"}`,b=t==="deposits"?"p_deposit_id":"p_withdrawal_id",{data:f,error:R}=await k.rpc(v,{[b]:h,p_admin_id:r.user.id});if(R)throw R;if(f&&!f.success)throw new Error(f.error);return f},Fe=async(t,h,u,v)=>{const b={status:u,reviewed_by:r.user.id,reviewed_at:new Date().toISOString()},{error:f}=await k.from(t).update(b).eq("id",h);if(f)throw f;if((t==="deposits"&&u==="approved"||t==="withdrawals"&&u==="rejected")&&v.userId){const{data:B}=await k.from("user_assets").select("id, amount").eq("user_id",v.userId).eq("symbol",v.currency).maybeSingle();if(B){const{error:P}=await k.from("user_assets").update({amount:parseFloat(B.amount)+parseFloat(v.amount)}).eq("id",B.id);if(P)throw P}else{const{error:P}=await k.from("user_assets").insert({user_id:v.userId,symbol:v.currency,amount:parseFloat(v.amount)});if(P)throw P}}},O=async(t,h,u,v={})=>{if(r){o(!0);try{if(t==="profiles"){const{error:f}=await k.from(t).update({kyc_status:u}).eq("id",h);if(f)throw f;s({title:"Success",description:`Status updated to ${u}`}),await T(),o(!1);return}const b=u==="approved"?"approve":"reject";try{await D(t,h,b)}catch{try{await se(t,h,b)}catch{await Fe(t,h,u,v)}}s({title:"Success",description:`Status updated to ${u}`}),await T()}catch(b){s({variant:"destructive",title:"Update failed",description:b.message})}o(!1)}},H=async t=>{g(t),o(!0);const{data:h,error:u}=await k.from("user_assets").select("*").eq("user_id",t.id);u?(s({variant:"destructive",title:"Failed to fetch balances",description:u.message}),S([])):S(h),o(!1)},Te=async(t,h)=>{const{error:u}=await k.from("user_assets").update({amount:h}).eq("id",t);u?s({variant:"destructive",title:"Update failed",description:u.message}):(s({title:"Success",description:"Balance updated"}),H(d))},Ie=async()=>{if(!d||!F.trim())return;const t=F.trim().toUpperCase(),{error:h}=await k.from("user_assets").insert({user_id:d.id,symbol:t,amount:0});h?s({variant:"destructive",title:"Add failed",description:h.message}):(s({title:"Success",description:`${t} balance added`}),A(""),H(d))},ze=async()=>{if(!y)return;o(!0);const{id:t,...h}=y,{error:u}=await k.from("trade_settings").update(h).eq("id",t);u?s({variant:"destructive",title:"Update failed",description:u.message}):(s({title:"Success",description:"Trade setting updated"}),C(null),await T()),o(!1)},te=async(t,h)=>{o(!0);const{data:u,error:v}=await k.from("profiles").update({trade_override_status:h}).eq("id",t).select().single();v?s({variant:"destructive",title:"Override failed",description:v.message}):(s({title:"Success",description:`Trade override for user set to: ${h||"OFF"}`}),g(u),l(b=>({...b,users:b.users.map(f=>f.id===t?u:f)}))),o(!1)},Pe=async(t,h)=>{o(!0);const{data:u,error:v}=await k.from("profiles").update({is_admin:!h}).eq("id",t).select().single();v?s({variant:"destructive",title:"Update failed",description:v.message}):(s({title:"Success",description:"User admin status updated"}),g(u),l(b=>({...b,users:b.users.map(f=>f.id===t?u:f)}))),o(!1)},I=t=>{switch(t==null?void 0:t.toLowerCase()){case"approved":case"win":case"completed":return e.jsx(E,{variant:"success",className:"bg-green-500",children:t});case"pending":return e.jsx(E,{variant:"secondary",children:t});case"rejected":case"loss":return e.jsx(E,{variant:"destructive",children:t});default:return e.jsx(E,{children:t||"N/A"})}},De=()=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:block",children:e.jsxs(Y,{children:[e.jsx(K,{children:e.jsxs(z,{children:[e.jsx(j,{children:"Name"}),e.jsx(j,{children:"Email"}),e.jsx(j,{children:"Role"}),e.jsx(j,{children:"KYC"}),e.jsx(j,{children:"Trade Override"}),e.jsx(j,{children:"Joined"}),e.jsx(j,{children:"Actions"})]})}),e.jsx(X,{children:i.users.map(t=>e.jsxs(z,{children:[e.jsxs(w,{children:[t.first_name||"N/A"," ",t.last_name||""]}),e.jsx(w,{children:t.email}),e.jsx(w,{children:t.is_admin?e.jsx(E,{className:"bg-purple-600",children:"Admin"}):e.jsx(E,{variant:"outline",children:"User"})}),e.jsx(w,{children:I(t.kyc_status)}),e.jsx(w,{children:t.trade_override_status?I(t.trade_override_status):e.jsx(E,{variant:"outline",children:"Off"})}),e.jsx(w,{children:new Date(t.created_at).toLocaleDateString()}),e.jsx(w,{children:e.jsx(N,{variant:"ghost",size:"icon",onClick:()=>H(t),children:e.jsx(Z,{className:"h-4 w-4"})})})]},t.id))})]})}),e.jsx("div",{className:"md:hidden",children:e.jsx(Qe,{users:i.users,getStatusBadge:I,onEdit:H})})]}),de=(t,h)=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:block",children:e.jsxs(Y,{children:[e.jsx(K,{children:e.jsxs(z,{children:[e.jsx(j,{children:"User"}),e.jsx(j,{children:"Email"}),e.jsx(j,{children:"Amount"}),e.jsx(j,{children:"Status"}),h==="deposits"&&e.jsx(j,{children:"Proof"}),h==="withdrawals"&&e.jsx(j,{children:"Address"}),e.jsx(j,{children:"Date"}),e.jsx(j,{children:"Actions"})]})}),e.jsx(X,{children:t.map(u=>{var v,b,f;return e.jsxs(z,{children:[e.jsxs(w,{children:[((v=u.users)==null?void 0:v.first_name)||"N/A"," ",((b=u.users)==null?void 0:b.last_name)||""]}),e.jsx(w,{children:(f=u.users)==null?void 0:f.email}),e.jsxs(w,{children:[u.amount," ",u.currency]}),e.jsx(w,{children:I(u.status)}),h==="deposits"&&e.jsx(w,{children:u.proof_url&&e.jsx(U,{children:e.jsx(fe,{asChild:!0,children:e.jsx(N,{variant:"outline",size:"icon",onClick:()=>p(u.proof_url),children:e.jsx(G,{className:"h-4 w-4"})})})})}),h==="withdrawals"&&e.jsx(w,{className:"truncate max-w-[150px]",children:u.wallet_address}),e.jsx(w,{children:new Date(u.created_at).toLocaleString()}),e.jsx(w,{className:"space-x-2",children:u.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(N,{size:"icon",variant:"ghost",className:"text-green-500",onClick:()=>O(h,u.id,"approved",{userId:u.user_id,amount:u.amount,currency:u.currency}),children:e.jsx(le,{className:"h-4 w-4"})}),e.jsx(N,{size:"icon",variant:"ghost",className:"text-red-500",onClick:()=>O(h,u.id,"rejected",{userId:u.user_id,amount:u.amount,currency:u.currency}),children:e.jsx(oe,{className:"h-4 w-4"})})]})})]},u.id)})})]})}),e.jsx("div",{className:"md:hidden",children:e.jsx(es,{items:t,type:h,getStatusBadge:I,onUpdateStatus:O,onViewProof:p,loading:a})})]}),Oe=()=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:block",children:e.jsxs(Y,{children:[e.jsx(K,{children:e.jsxs(z,{children:[e.jsx(j,{children:"Name"}),e.jsx(j,{children:"Email"}),e.jsx(j,{children:"Country"}),e.jsx(j,{children:"Status"}),e.jsx(j,{children:"Document"}),e.jsx(j,{children:"Actions"})]})}),e.jsx(X,{children:i.kyc.map(t=>e.jsxs(z,{children:[e.jsxs(w,{children:[t.first_name," ",t.last_name]}),e.jsx(w,{children:t.email||"N/A"}),e.jsx(w,{children:t.country||"N/A"}),e.jsx(w,{children:I(t.kyc_status)}),e.jsx(w,{children:t.id_document_url&&e.jsx(U,{children:e.jsx(fe,{asChild:!0,children:e.jsx(N,{variant:"outline",size:"icon",onClick:()=>p(t.id_document_url),children:e.jsx(G,{className:"h-4 w-4"})})})})}),e.jsx(w,{className:"space-x-2",children:t.kyc_status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(N,{size:"icon",variant:"ghost",className:"text-green-500",onClick:()=>O("profiles",t.id,"approved",{kyc:!0}),children:e.jsx(le,{className:"h-4 w-4"})}),e.jsx(N,{size:"icon",variant:"ghost",className:"text-red-500",onClick:()=>O("profiles",t.id,"rejected",{kyc:!0}),children:e.jsx(oe,{className:"h-4 w-4"})})]})})]},t.id))})]})}),e.jsx("div",{className:"md:hidden",children:e.jsx(ss,{users:i.kyc,getStatusBadge:I,onUpdateStatus:O,onViewDoc:p,loading:a})})]}),Be=()=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:block",children:e.jsxs(Y,{children:[e.jsx(K,{children:e.jsxs(z,{children:[e.jsx(j,{children:"Duration (s)"}),e.jsx(j,{children:"Win Rate (%)"}),e.jsx(j,{children:"Loss Rate (%)"}),e.jsx(j,{children:"Min Capital"}),e.jsx(j,{children:"Actions"})]})}),e.jsx(X,{children:i.tradeSettings.map(t=>e.jsxs(z,{children:[e.jsx(w,{children:t.duration}),e.jsx(w,{children:(t.win_rate*100).toFixed(2)}),e.jsx(w,{children:(t.loss_rate*100).toFixed(2)}),e.jsx(w,{children:t.min_capital}),e.jsx(w,{children:e.jsx(N,{size:"icon",variant:"ghost",onClick:()=>C(t),children:e.jsx(Z,{className:"h-4 w-4"})})})]},t.id))})]})}),e.jsx("div",{className:"md:hidden",children:e.jsx(ts,{settings:i.tradeSettings,onEdit:C})})]});return e.jsxs(e.Fragment,{children:[e.jsx(Ve,{children:e.jsx("title",{children:"Admin Panel - MetaTradeX"})}),e.jsxs("div",{className:"px-4 sm:px-6 lg:px-8 py-4 sm:py-6 lg:py-8 max-w-7xl mx-auto",children:[e.jsxs(pe.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"flex items-center justify-between gap-4 mb-6",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Admin Panel"}),e.jsx(N,{onClick:T,disabled:a,variant:"outline",size:"icon",className:"shrink-0",children:e.jsx(Ye,{className:`h-4 w-4 ${a?"animate-spin":""}`})})]}),e.jsxs(We,{value:n,onValueChange:c,className:"w-full",children:[e.jsx("div",{className:"-mx-4 sm:mx-0 px-4 sm:px-0 overflow-x-auto scrollbar-hide",children:e.jsxs(He,{className:"inline-flex w-auto min-w-full sm:w-full sm:grid sm:grid-cols-5 mb-4 h-auto p-1",children:[e.jsxs(M,{value:"users",className:"gap-1.5 px-3 py-2 text-xs sm:text-sm whitespace-nowrap",children:[e.jsx(Ge,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 shrink-0"}),"Users"]}),e.jsxs(M,{value:"deposits",className:"gap-1.5 px-3 py-2 text-xs sm:text-sm whitespace-nowrap",children:[e.jsx(je,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 shrink-0"}),"Deposits"]}),e.jsxs(M,{value:"withdrawals",className:"gap-1.5 px-3 py-2 text-xs sm:text-sm whitespace-nowrap",children:[e.jsx(je,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 shrink-0"}),"Withdrawals"]}),e.jsxs(M,{value:"kyc",className:"gap-1.5 px-3 py-2 text-xs sm:text-sm whitespace-nowrap",children:[e.jsx(Ke,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 shrink-0"}),"KYC"]}),e.jsxs(M,{value:"settings",className:"gap-1.5 px-3 py-2 text-xs sm:text-sm whitespace-nowrap",children:[e.jsx(Ze,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 shrink-0"}),"Trading"]})]})}),e.jsxs(pe.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[e.jsx(q,{value:"users",children:a?e.jsx("p",{className:"text-center py-8 text-muted-foreground",children:"Loading..."}):De()}),e.jsx(q,{value:"deposits",children:a?e.jsx("p",{className:"text-center py-8 text-muted-foreground",children:"Loading..."}):de(i.deposits,"deposits")}),e.jsx(q,{value:"withdrawals",children:a?e.jsx("p",{className:"text-center py-8 text-muted-foreground",children:"Loading..."}):de(i.withdrawals,"withdrawals")}),e.jsx(q,{value:"kyc",children:a?e.jsx("p",{className:"text-center py-8 text-muted-foreground",children:"Loading..."}):Oe()}),e.jsx(q,{value:"settings",children:a?e.jsx("p",{className:"text-center py-8 text-muted-foreground",children:"Loading..."}):Be()})]},n)]})]}),e.jsx(U,{open:!!x,onOpenChange:()=>p(null),children:e.jsxs(ae,{className:"max-w-[95vw] sm:max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsx(ne,{children:e.jsx(ie,{children:"Document Viewer"})}),x&&e.jsx("img",{src:x,alt:"KYC or Deposit Proof",className:"max-w-full h-auto rounded-md"}),e.jsxs(ce,{children:[e.jsx(N,{onClick:()=>window.open(x,"_blank"),children:"Download"}),e.jsx(N,{onClick:()=>p(null),children:"Close"})]})]})}),e.jsx(U,{open:!!d,onOpenChange:()=>g(null),children:e.jsxs(ae,{className:"max-w-[95vw] sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ne,{children:[e.jsxs(ie,{className:"text-base sm:text-lg pr-6",children:["Edit User: ",d==null?void 0:d.first_name," ",d==null?void 0:d.last_name]}),e.jsx(Je,{children:"Manage user balances and trade outcomes."})]}),e.jsxs("div",{className:"py-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 p-3 border rounded-md bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(Xe,{className:"h-4 w-4 text-purple-600 shrink-0"}),e.jsxs("div",{className:"space-y-0.5 min-w-0",children:[e.jsx(L,{className:"text-sm sm:text-base",children:"Admin Status"}),e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground",children:"Grant full administrative access."})]})]}),e.jsx(Re,{checked:d==null?void 0:d.is_admin,onCheckedChange:()=>Pe(d.id,d.is_admin),disabled:a})]}),e.jsx("h3",{className:"font-semibold text-sm",children:"Balances"}),a?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading balances..."}):_.map(t=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-16 sm:w-20 text-xs sm:text-sm shrink-0",children:t.symbol}),e.jsx(V,{type:"number",defaultValue:t.amount,onBlur:h=>Te(t.id,h.target.value)})]},t.id)),e.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[e.jsx(V,{placeholder:"Symbol (e.g. BTC)",value:F,onChange:t=>A(t.target.value),className:"flex-1 min-w-0"}),e.jsx(N,{variant:"outline",size:"sm",onClick:Ie,disabled:!F.trim(),className:"shrink-0 whitespace-nowrap",children:"Add"})]}),e.jsx("h3",{className:"font-semibold text-sm pt-4",children:"Trade Control"}),e.jsxs("div",{className:"p-3 rounded-md border bg-background/50 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(L,{className:"text-sm",children:"Current Status:"}),d!=null&&d.trade_override_status?I(d.trade_override_status):e.jsx(E,{variant:"outline",children:"OFF"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[e.jsx(N,{variant:"success",className:"bg-green-600 hover:bg-green-700 text-white",onClick:()=>te(d.id,"win"),disabled:a||(d==null?void 0:d.trade_override_status)==="win",children:"Win ON"}),e.jsx(N,{variant:"destructive",onClick:()=>te(d.id,"loss"),disabled:a||(d==null?void 0:d.trade_override_status)==="loss",children:"Loss ON"}),e.jsx(N,{variant:"outline",onClick:()=>te(d.id,null),disabled:a||!(d!=null&&d.trade_override_status),children:"OFF"})]})]})]}),e.jsx(ce,{children:e.jsx(N,{onClick:()=>g(null),children:"Close"})})]})}),e.jsx(U,{open:!!y,onOpenChange:()=>C(null),children:e.jsxs(ae,{className:"max-w-[95vw] sm:max-w-lg",children:[e.jsx(ne,{children:e.jsxs(ie,{children:["Edit Setting for ",y==null?void 0:y.duration,"s"]})}),y&&e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2 sm:grid sm:grid-cols-4 sm:items-center sm:gap-4 sm:space-y-0",children:[e.jsx(L,{htmlFor:"win_rate",className:"text-sm sm:text-right",children:"Win Rate (%)"}),e.jsx(V,{id:"win_rate",type:"number",value:y.win_rate*100,onChange:t=>C({...y,win_rate:parseFloat(t.target.value)/100}),className:"sm:col-span-3"})]}),e.jsxs("div",{className:"space-y-2 sm:grid sm:grid-cols-4 sm:items-center sm:gap-4 sm:space-y-0",children:[e.jsx(L,{htmlFor:"loss_rate",className:"text-sm sm:text-right",children:"Loss Rate (%)"}),e.jsx(V,{id:"loss_rate",type:"number",value:y.loss_rate*100,onChange:t=>C({...y,loss_rate:parseFloat(t.target.value)/100}),className:"sm:col-span-3"})]}),e.jsxs("div",{className:"space-y-2 sm:grid sm:grid-cols-4 sm:items-center sm:gap-4 sm:space-y-0",children:[e.jsx(L,{htmlFor:"min_capital",className:"text-sm sm:text-right",children:"Min Capital"}),e.jsx(V,{id:"min_capital",type:"number",value:y.min_capital,onChange:t=>C({...y,min_capital:parseFloat(t.target.value)}),className:"sm:col-span-3"})]})]}),e.jsx(ce,{children:e.jsx(N,{onClick:ze,disabled:a,children:a?"Saving...":"Save Changes"})})]})})]})};export{Ps as default};
