import{c as H,u as U,h as F,b as Y,a as B,d as O,r as c,e as x,j as e,B as i,A as z,k as X,S as G,i as _}from"./index-83226fdf.js";import{H as J}from"./Helmet-d124395d.js";import{C as T,a as E,b as S,c as A}from"./card-1e50d30c.js";import{T as K,a as Q,b as L,c as D}from"./tabs-a4cebf4b.js";import{T as W}from"./TransactionsHistory-628acbe8.js";import{C as Z}from"./cryptoPrices-f92ea880.js";import"./table-f272782e.js";const ee=H("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),se=H("Repeat",[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]]),ce=()=>{const{t:n}=U(),{formatCurrency:u,currency:q,exchangeRates:R}=F(),a=Y(),{user:t,userProfile:p}=B(),{toast:g}=O(),[j,M]=c.useState([]),[b,y]=c.useState(!0),[P,V]=c.useState(0),o=c.useCallback(async()=>{if(t){y(!0);try{const[{data:s,error:d},{data:$,error:v}]=await Promise.all([x.from("user_assets").select("symbol, amount").eq("user_id",t.id),x.from("assets").select("symbol, price, icon_url, name")]);if(d)throw d;if(v)throw v;const m=Object.entries(Z).reduce((r,[h,l])=>(r[h]={price:l.price,icon:l.icon_url,name:l.name},r),{});($||[]).forEach(r=>{m[r.symbol]={price:r.price,icon:r.icon_url,name:r.name}});let w=0;const I=(s||[]).map(r=>{var N,C,k;const h=((N=m[r.symbol])==null?void 0:N.price)||0,l=r.amount*h;return w+=l,{symbol:r.symbol,name:((C=m[r.symbol])==null?void 0:C.name)||r.symbol,amount:r.amount,value:l,price:h,logo:(k=m[r.symbol])==null?void 0:k.icon}}).filter(r=>r.amount>0);M(I),V(w)}catch(s){console.error("Error fetching portfolio data:",s),g({variant:"destructive",title:"Error",description:"Could not fetch portfolio data."})}finally{y(!1)}}},[t,g]);c.useEffect(()=>{o();const s=x.channel("realtime-portfolio").on("postgres_changes",{event:"*",schema:"public",table:"user_assets",filter:`user_id=eq.${t==null?void 0:t.id}`},()=>{o()}).on("postgres_changes",{event:"*",schema:"public",table:"deposits",filter:`user_id=eq.${t==null?void 0:t.id}`},()=>{o()}).on("postgres_changes",{event:"*",schema:"public",table:"withdrawals",filter:`user_id=eq.${t==null?void 0:t.id}`},()=>{o()}).on("postgres_changes",{event:"*",schema:"public",table:"transactions",filter:`user_id=eq.${t==null?void 0:t.id}`},()=>{o()}).subscribe();return()=>{x.removeChannel(s)}},[o,t==null?void 0:t.id]);const f=s=>{const d=R[q.toLowerCase()]||1;return s*d};return e.jsxs(e.Fragment,{children:[e.jsx(J,{children:e.jsxs("title",{children:[n("portfolio")," - MetaTradeX"]})}),e.jsxs("div",{className:"container mx-auto p-4 sm:p-6 lg:p-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold tracking-tight",children:n("portfolio")}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"An overview of your crypto assets and history."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{onClick:()=>a("/deposit"),children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),n("deposit")]}),e.jsxs(i,{onClick:()=>a("/withdraw"),children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),n("withdraw")]}),e.jsxs(i,{variant:"outline",onClick:()=>a("/swap"),children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),n("swap")]}),(p==null?void 0:p.is_admin)&&e.jsxs(i,{variant:"secondary",onClick:()=>a("/admin"),children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),"Admin"]})]})]}),e.jsxs(T,{className:"bg-gradient-to-br from-primary/10 via-background to-secondary/10 glowing-border mb-8",children:[e.jsx(E,{children:e.jsx(S,{className:"text-muted-foreground font-normal",children:"Total Portfolio Value"})}),e.jsx(A,{children:e.jsx("p",{className:"text-5xl font-bold tracking-tight",children:b?e.jsx(_,{className:"h-12 w-12 animate-spin"}):u(f(P))})})]}),e.jsxs(K,{defaultValue:"assets",className:"w-full",children:[e.jsxs(Q,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsx(L,{value:"assets",children:"Your Assets"}),e.jsxs(L,{value:"history",children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),"History"]})]}),e.jsx(D,{value:"assets",children:b?e.jsx("div",{className:"text-center p-10",children:e.jsx(_,{className:"mx-auto h-10 w-10 animate-spin"})}):j.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:j.map(s=>e.jsxs(T,{className:"flex flex-col glassmorphic hover:border-primary transition-all",children:[e.jsxs(E,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.logo&&e.jsx("img",{src:s.logo,alt:s.symbol,className:"h-10 w-10"}),e.jsxs("div",{children:[e.jsx(S,{className:"text-lg",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.symbol})]})]}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>a(`/trading/${s.symbol.toLowerCase()}`),children:"Trade"})]}),e.jsxs(A,{className:"flex-grow flex flex-col justify-end",children:[e.jsx("p",{className:"text-2xl font-bold",children:u(f(s.value))}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[parseFloat(s.amount).toFixed(6)," ",s.symbol," @ ",u(f(s.price))]})]})]},s.symbol))}):e.jsxs("div",{className:"text-center py-20 px-4 rounded-lg border-2 border-dashed",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Your portfolio is empty."}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Deposit funds to start your trading journey."}),e.jsx(i,{className:"mt-4",onClick:()=>a("/deposit"),children:"Deposit Now"})]})}),e.jsx(D,{value:"history",children:e.jsx(W,{})})]})]})]})};export{ce as default};
