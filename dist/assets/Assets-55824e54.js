import{a as k,h as I,u as A,b as R,d as H,r as t,e as p,j as e,i as _,B as x}from"./index-d9a06326.js";import{H as O}from"./Helmet-90a894cc.js";import{C as $,d as q}from"./card-308cff17.js";import{I as b}from"./input-d1fd22f3.js";import{L as B}from"./label-b53f8564.js";import{D as z,a as M,b as X,c as Y,d as G,e as J}from"./dialog-8e203f57.js";import{C as K}from"./cryptoPrices-f92ea880.js";import{P as Q}from"./pen-square-6c524a28.js";const u=Object.entries(K).map(([i,c])=>({symbol:i,name:c.name,price:c.price,icon_url:c.icon_url,price_change_percentage_24h:0})),ne=()=>{const{t:i}=k(),{formatCurrency:c,currency:N,exchangeRates:S}=I(),y=A(),{userProfile:r}=R(),{toast:o}=H(),[E,g]=t.useState([]),[f,L]=t.useState(""),[j,d]=t.useState(!0),[a,m]=t.useState(null),[h,C]=t.useState(""),v=t.useCallback(async()=>{const s=u.map(l=>({symbol:l.symbol,name:l.name,price:l.price,icon_url:l.icon_url,price_change_percentage_24h:0})),{error:n}=await p.from("assets").insert(s);return!n},[]),w=t.useCallback(async()=>{d(!0);try{const{data:s,error:n}=await p.from("assets").select("*").order("id");if(n)throw n;if((!s||s.length===0)&&(r!=null&&r.is_admin)&&await v()){const{data:U}=await p.from("assets").select("*").order("id");g(U||u);return}g(s&&s.length>0?s:u)}catch(s){console.error("Error fetching assets:",s),g(u)}finally{d(!1)}},[o,r,v]);t.useEffect(()=>{w()},[w]);const D=s=>{m(s),C(s.price)},P=async()=>{if(!a||!h||parseFloat(h)<0){o({variant:"destructive",title:"Invalid Price",description:"Please enter a valid price."});return}d(!0);const{error:s}=await p.from("assets").update({price:parseFloat(h)}).eq("id",a.id);s?o({variant:"destructive",title:"Update Failed",description:s.message}):(o({title:"Success!",description:`${a.name} price updated.`}),m(null),C(""),await w()),d(!1)},F=E.filter(s=>s.name.toLowerCase().includes(f.toLowerCase())||s.symbol.toLowerCase().includes(f.toLowerCase())),T=s=>{const n=S[N.toLowerCase()]||1;return s*n};return e.jsxs(e.Fragment,{children:[e.jsx(O,{children:e.jsxs("title",{children:[i("assets")," - MetaTradeX"]})}),e.jsxs("div",{className:"container mx-auto px-6 py-4 sm:p-6 lg:p-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-6 gap-4",children:[e.jsx("h1",{className:"text-3xl font-bold",children:i("topCryptos")}),e.jsx("div",{className:"w-full sm:w-auto sm:max-w-xs",children:e.jsx(b,{type:"text",placeholder:"Search assets...",value:f,onChange:s=>L(s.target.value)})})]}),j&&!a?e.jsx("div",{className:"text-center h-64 flex items-center justify-center",children:e.jsx(_,{className:"h-10 w-10 animate-spin"})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:F.map(s=>e.jsxs($,{className:"hover:shadow-lg transition-shadow glassmorphic relative",children:[(r==null?void 0:r.is_admin)&&e.jsx(x,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 h-8 w-8",onClick:()=>D(s),children:e.jsx(Q,{className:"h-4 w-4"})}),e.jsxs(q,{className:"p-4 flex flex-col justify-between h-full",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("img",{src:s.icon_url,alt:s.name,className:"h-10 w-10 mr-4"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-lg",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.symbol.toUpperCase()})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-lg",children:c(T(s.price))}),e.jsxs("p",{className:`text-sm ${s.price_change_percentage_24h>=0?"text-green-500":"text-red-500"}`,children:[s.price_change_percentage_24h?s.price_change_percentage_24h.toFixed(2):"0.00","%"]})]}),e.jsx(x,{className:"w-full mt-4",onClick:()=>y(`/trading/${s.symbol.toLowerCase()}`),children:i("trading")})]})]},s.id))})]}),e.jsx(z,{open:!!a,onOpenChange:()=>m(null),children:e.jsxs(M,{children:[e.jsxs(X,{children:[e.jsxs(Y,{children:["Edit Price for ",a==null?void 0:a.name]}),e.jsxs(G,{children:["Update the price for ",a==null?void 0:a.symbol.toUpperCase(),"."]})]}),e.jsxs("div",{className:"py-4",children:[e.jsx(B,{htmlFor:"price",children:"New Price (USD)"}),e.jsx(b,{id:"price",type:"number",value:h,onChange:s=>C(s.target.value),placeholder:"Enter new price"})]}),e.jsxs(J,{children:[e.jsx(x,{variant:"outline",onClick:()=>m(null),children:"Cancel"}),e.jsx(x,{onClick:P,disabled:j,children:j?e.jsx(_,{className:"h-4 w-4 animate-spin"}):"Update Price"})]})]})})]})};export{ne as default};
